---
title: "React Query"
date: "2025-10-11"
tags: ["React"]
image: "/thumbnails/react-query.jpg"
---

### React Query(TanStack Query) ë¼ì´ë¸ŒëŸ¬ë¦¬

- Reactì—ì„œ Axios ê°™ì€ ë¹„ë™ê¸° ë°ì´í„° ì²˜ë¦¬ ì‘ì—…ì„ ì‰½ê²Œ í•˜ê¸° ìœ„í•´ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ,
  ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , ìºì‹œí•˜ë©°, ìë™ ê°±ì‹  ë“±ì˜ ì‘ì—…ì„ `useState`, `useEffect`ì—†ì´ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ

```bash
npm i @tanstack/react-query
npm i @tanstack/react-query-devtools
# ë‘ ê°€ì§€ë¥¼ ë™ì‹œì— ì„¤ì¹˜í•˜ê³  ì‹¶ì„ ë• ì•„ë˜ ì½”ë“œë¡œ ì„¤ì¹˜í•˜ë©´ ë¨
npm i @tanstack/react-query @tanstack/react-query-devtools
```

**ê³µì‹ ë¬¸ì„œ ì°¸ê³  ğŸ“„**
[TanStack Query](https://tanstack.com/query/latest)

---

### ì£¼ìš” ê°œë… ìš”ì•½

| ì¢…ë¥˜                    | í›…                                        | ì„¤ëª…                                    |
| ----------------------- | ----------------------------------------- | --------------------------------------- |
| ì¡°íšŒ(GET)               | **useQuery**                              | ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , ìºì‹œì— ì €ì¥ |
| ë³€ê²½(POST, PUT, DELETE) | **useMutation**                           | ì„œë²„ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©          |
| ì „ì—­ í´ë¼ì´ì–¸íŠ¸         | **QueryClient** / **QueryClientProvider** | ì „ì²´ ì•±ì— React Query ê¸°ëŠ¥ ì œê³µ         |
| ê°œë°œ ë„êµ¬               | **ReactQueryDevtools**                    | ìš”ì²­, ì‘ë‹µ, ìºì‹œ ìƒíƒœ ë“±ì„ í™•ì¸         |

---

### useQuery

- **useQueryë€?**
  ì„œë²„ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•˜ë©°, ì‘ë‹µ ë°›ì€ ë°ì´í„°ëŠ” ìºì‹œë˜ë©°, ë‹¤ìŒë²ˆ ìš”ì²­ ì‹œ ì„œë²„ì— ìš”ì²­í•˜ì§€ ì•Šê³  ìºì‹œëœ ë°ì´í„°ë¥¼ ë°˜í™˜í•¨ (ìºì‹œê°€ ìœ íš¨í•˜ë©´ ì¬ìš”ì²­ ì—†ì´ ë°˜í™˜ë¨)

**React Query ê¸°ë³¸ ì„¤ì •**

```tsx
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import App from "./App.tsx";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";

const queryClient = new QueryClient(); // í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•¨

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <QueryClientProvider client={queryClient}>
      <App />
      <ReactQueryDevtools />
    </QueryClientProvider>
  </StrictMode>
);
```

- **QueryClientProvider** : ì „ì²´ ì•±ì—ì„œ React Query ê¸°ëŠ¥ì„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ í•¨
  - **client**ëŠ” ìƒì„±í•œ í´ë¼ì´ì–¸íŠ¸ë¥¼ **props**ë¡œ ë„˜ê¹€
- **ReactQueryDevtools** : **devtools**ì—ì„œ ìš”ì²­ ë° ìºì‹œ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ

**Options**

- **queryKey** : ìºì‹œ ì‹ë³„ì ì—­í• ë¡œ, ë°°ì—´ í˜•íƒœë¡œ ì‘ì„± / ì²« ìš”ì†ŒëŠ” ì½”ì • í‚¤, ê·¸ ë’¤ëŠ” ë™ì  íŒŒë¼ë¯¸í„°
- **queryFn** : ì‹¤ì œ ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ë¡œ, **axios.get**ì´ë‚˜ **fetch**ë“± ê°€ëŠ¥
- **select** : ì‘ë‹µì—ì„œ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œí•˜ëŠ” ì „ì²˜ë¦¬ í•¨ìˆ˜ ex) **res.data.item**ë§Œ ê°€ì ¸ì˜¤ê¸°
- **retry** : ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„ íšŸìˆ˜ ( ê¸°ë³¸ê°’ 3)
- **refetchOnWindowFocus** : ë‹¤ë¥¸ íƒ­ì´ë‚˜ ì•± ê°”ë‹¤ê°€ ëŒì•„ì˜¬ ë•Œ ìë™ ì¬ìš”ì²­ ì—¬ë¶€ ( ê¸°ë³¸ê°’ **true**)
- **staleTime** : ë°ì´í„°ë¥¼ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ì‹œê°„( ì‹œê°„ì´ ì§€ë‚˜ë©´ ì˜¤ë˜ëœ ìƒíƒœë¡œ íŒë‹¨í•˜ì—¬ ë‹¤ì‹œ ìƒˆë¡œìš´ ìš”ì²­ì„ ì¤€ë¹„í•¨)
- **refetchInterval** : ì„¤ì •í•œ ì£¼ê¸°ë§ˆë‹¤ ìë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìƒˆë¡œ ë°›ì•„ì˜´

```tsx
import { useQuery } from "@tanstack/react-query";

const axios = useAxiosInstance();

const { data, isLoading, error } = useQuery({
  queryKey: ["posts", 1, "replies"],
  queryFn: () =>
    axios.get("/posts/1/replies", {
      params: {
        delay: 1000,
      },
    }),
  select: (response: { data: ReplyListResType }) => response.data.item,
  retry: 3,
  refetchOnWindowFocus: true,
  staleTime: 1000 * 5,
  refetchInterval: 1000 * 3,
});
```

---

### useMutation

- ì„œë²„ì˜ ë°ì´í„°ë¥¼ ë³€ê²½í•  ë•Œ ì‚¬ìš© ì´ë²¤íŠ¸ ë‚´ì—ì„œ ì‚¬ìš©í•´ì•¼ í•¨ (**POST**, **PUT**, **PATCH**, **DELETE**)

**Options**

- **mutate** : ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ **mutate**ë¥¼ í˜¸ì¶œí•˜ë©´ **mutationFn**ì´ í˜¸ì¶œë˜ë©´ì„œ ì‹¤ì œ ë¹„ë™ê¸° ìš”ì²­ì´ ë°œìƒí•¨
- **mutationFn** : ì‹¤ì œ ë¹„ë™ê¸° ìš”ì²­ í•¨ìˆ˜ë¡œ, **axios**ì˜ POST/PUT
- **onSuccess** : ìš”ì²­ ì„±ê³µ ì‹œ ì‹¤í–‰í•  ì½œë°± (ìƒíƒœ ì´ˆê¸°í™”, ìƒˆë¡œê³ ì¹¨ ë“±..)
- **queryClient.invalidateQueries** : í•´ë‹¹ ì¿¼ë¦¬ í‚¤ì˜ ë°ì´í„°ë¥¼ ê°•ì œë¡œ **refetch**í•˜ë„ë¡ íŠ¸ë¦¬ê±° (ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë„ë¡ ì‹ í˜¸ë¥¼ ì¤Œ)

```tsx
import { useMutation, useQueryClient } from "@tanstack/react-query";

const queryClient = useQueryClient();
const { mutate, isPending } = useMutation({
  mutationFn: (formData: FormData) => axios.post("/posts/1/replies", formData),
  onSuccess() {
    setContent("");
    // ëŒ“ê¸€ ë“±ë¡ í›„ ëŒ“ê¸€ ëª©ë¡ ê°±ì‹ 
    queryClient.invalidateQueries({ queryKey: ["posts", 1, "replies"] });
  },
});

const handleAddComment = (event: React.FormEvent<HTMLFormElement>) => {
  // ì¤‘ë³µ ìš”ì²­ ë°©ì§€
  event.preventDefault(); // í¼ ì œì¶œ ë°©ì§€
  const formData = new FormData(event.currentTarget);
  mutate(formData); // ëŒ“ê¸€ ë“±ë¡ ìš”ì²­
};

return (
  <>
    <h4>ëŒ“ê¸€ ë“±ë¡</h4>
    <form onSubmit={handleAddComment}>
      <textarea
        value={content}
        name="content"
        onChange={(e) => setContent(e.target.value)}
        rows={3}
        cols={30}
        placeholder="ëŒ“ê¸€ ë‚´ìš©"
      />
      <br />
      <button type="submit" disabled={isPending}>
        ë“±ë¡
      </button>
    </form>
  </>
); // buttoníƒœê·¸ì— disabled={isPendig}ì„ ì¶”ê°€í•˜ì—¬ ì¤‘ë³µ ë“±ë¡ì„ ë°©ì§€í•¨
```

### useQueryClient

- React ì „ì²´ì—ì„œ ì‚¬ìš©í•˜ëŠ” **QueryClient** ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜¤ëŠ” í›…ìœ¼ë¡œ, ë‚´ë¶€ì ìœ¼ë¡œ ëª¨ë“  ìºì‹œ, ìƒíƒœ ê´€ë¦¬, ìš”ì²­ ì²˜ë¦¬ë“±ì„ í†µì œí•˜ëŠ” ì—­í• ì„ í•¨
- **useMutation**ì€ ìì²´ì ìœ¼ë¡œ ìºì‹œë¥¼ ì €ì¥í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, **useQueryClient**ë¥¼ í†µí•´ **invalidateQueries**, **setQueryData** ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ ì¿¼ë¦¬ì˜ ìºì‹œë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆìŒ

```tsx
const queryClient = useQueryClient();
// ëŒ“ê¸€ì„ ìƒˆë¡œ ë‹¬ì•˜ìœ¼ë‹ˆ 1ë²ˆ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ëª©ë¡ë§Œ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê²Œ í•˜ëŠ” ì²˜ë¦¬
queryClient.invalidateQueries({ queryKey: ["posts", 1, "replies"] });
```

### invalidateQueries

- ë¬´íš¨í™” ë¼ëŠ” ëœ»ìœ¼ë¡œ íŠ¹ì • **queryKey**ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ **stale**(ì˜¤ë˜ëœ) ìƒíƒœë¡œ ë§Œë“ ë‹¤ëŠ” ì˜ë¯¸
- í•´ë‹¹ **queryKey**ì— ëŒ€í•œ ìºì‹œ ë°ì´í„°ë¥¼ **stale**ë¡œ ì„¤ì •í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸, í¬ì»¤ìŠ¤, ë¦¬ë Œë”ë§ ë˜ë©´ ìë™ìœ¼ë¡œ ì¬ìš”ì²­ í•˜ë„ë¡ í•¨
- ë‹¤ë¥¸ ê¸°ëŠ¥ì„ í•˜ëŠ” í•¨ìˆ˜ë“¤ë¡œëŠ” `removeQueries()`(ìºì‹œ ì‚­ì œ), `cancelQueries()`(ì§„í–‰ ì¤‘ì¸ ìš”ì²­ ì·¨ì†Œ), `refetchQueries()`(ìºì‹œ ë¬´ì‹œí•˜ê³  ì¬ìš”ì²­), `getQueryData()`(ìºì‹œì—ì„œ í˜„ì¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´), `setQueryData()`(ìºì‹œì— ìˆ˜ë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì„¤ì •) ë“±ì´ ìˆìŒ

---

### **useInfiniteQuery**

- React Queryì—ì„œ **ë¬´í•œ ìŠ¤í¬ë¡¤**ì´ë‚˜ **í˜ì´ì§€ë„¤ì´ì…˜** ê¸°ëŠ¥ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” í›… ( **í˜ì´ì§€ë„¤ì´ì…˜**(**pagination**)ì€ ë§ì€ ì–‘ì˜ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë‹¤ ë³´ì—¬ì£¼ì§€ ì•Šê³ , ì—¬ëŸ¬ í˜ì´ì§€ë¡œ ë‚˜ëˆ ì„œ ì¡°ê¸ˆì”© ë³´ì—¬ì£¼ëŠ” ë°©ë²•ì„ ë§í•¨)

**ê¸°ëŠ¥**

**í˜ì´ì§€ ë‹¨ìœ„ ë°ì´í„° ìš”ì²­**

- ìŠ¤í¬ë¡¤ì´ ë‚´ë ¤ê°€ê±°ë‚˜ â€˜ë” ë³´ê¸°â€™ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë‹¤ìŒ í˜ì´ì§€ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜´

**ë°ì´í„° ìºì‹± ë° ê´€ë¦¬**

- ê° í˜ì´ì§€ë³„ ë°ì´í„°ë¥¼ **data.pages** ë°°ì—´ì— ì €ì¥í•´ì„œ ê´€ë¦¬í•¨

**ì´ì „/ë‹¤ìŒ í˜ì´ì§€ ì²˜ë¦¬**

- **getNextPageParam**, **getPreviousPageParam** ì˜µì…˜ìœ¼ë¡œ ë‹¤ìŒ í˜ì´ì§€ì™€ ì´ì „ í˜ì´ì§€ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŒ

```jsx
const {
  // íŒŒë¼ë¯¸í„°
  data, // ë¶ˆëŸ¬ì˜¨ ë°ì´í„° (í˜ì´ì§€ë³„ë¡œ ë¶„ë¦¬ëœ ë°°ì—´)
  fetchNextPage, // ë‹¤ìŒ í˜ì´ì§€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
  fetchPreviousPage, // ì´ì „ í˜ì´ì§€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
  hasNextPage, // ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ (true/false)
  hasPreviousPage, // ì´ì „ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ (true/false)
  isFetchingNextPage, // ë‹¤ìŒ í˜ì´ì§€ê°€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì¸ì§€ ì—¬ë¶€
  isFetchingPreviousPage, // ì´ì „ í˜ì´ì§€ê°€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì¸ì§€ ì—¬ë¶€
  promise, // í˜„ì¬ ì¿¼ë¦¬ì˜ Promiseê°ì²´ (ë¹„ë™ê¸° ì‘ì—… ìƒíƒœ)
  ...result // ë‚˜ë¨¸ì§€ ê²°ê³¼ ê°’ë“¤ (ì—ëŸ¬, ë¡œë”©, ìƒíƒœ ë“±)
} = useInfiniteQuery({
  queryKey, // ì¿¼ë¦¬ì˜ ê³ ìœ  ì‹ë³„ì (ìºì‹±, ê°±ì‹  ë“±ì— ì‚¬ìš©ë¨)
  queryFn: ({ pageParam }) => fetchPage(pageParam), // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
  initialPageParam: 1, // ì²« í˜ì´ì§€ë¥¼ 1ë¡œ ì„¤ì •
  ...options, // ë‚˜ë¨¸ì§€ ì„ íƒ ì˜µì…˜ë“¤
  // ë‹¤ìŒ í˜ì´ì§€ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì–´ë–»ê²Œ êµ¬í• ì§€ ì •ì˜ (ì—†ìœ¼ë©´ undefined)
  getNextPageParam: (lastPage, allPages, lastPageParam, allPageParams) =>
    lastPage.nextCursor,
  // ì´ì „ í˜ì´ì§€ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì–´ë–»ê²Œ êµ¬í• ì§€ ì •ì˜ (ì—†ìœ¼ë©´ undefined)
  getPreviousPageParam: (firstPage, allPages, firstPageParam, allPageParams) =>
    firstPage.prevCursor,
});
```

**Options**

- **queryKey** : ì¿¼ë¦¬ë¥¼ êµ¬ë¶„í•˜ëŠ” ê³ ìœ  í‚¤ ( ë°°ì—´ í˜•íƒœê°€ ì¼ë°˜ì ì„)
- **queryFn** : ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ (**pageParam**)ì„ ë°›ì•„ í˜ì´ì§€ë³„ ìš”ì²­
- **initialPageParams** : ì´ˆê¸° í˜ì´ì§€ ì„¤ì •
- **getNextPageParams** : ë‹¤ìŒ í˜ì´ì§€ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œ í•¨ìˆ˜ (ì—†ìœ¼ë©´ ë‹¤ìŒ í˜ì´ì§€ ì—†ìŒ ì²˜ë¦¬)
- **getPreviousPageParam** : ì´ì „ í˜ì´ì§€ íŒŒë¼ë¯¸í„° ì¶”ì¶œ í•¨ìˆ˜ ( ì´ì „ í˜ì´ì§€ ë¶ˆëŸ¬ì˜¬ ë•Œ ì‚¬ìš©)
- **enabled** : ì¿¼ë¦¬ ì‹¤í–‰ ì—¬ë¶€ ì œì–´ (**false**ë©´ ìë™ ì‹¤í–‰ ì•ˆí•¨)
- **staleTime** : ë°ì´í„°ê°€ ì‹ ì„ í•œ ìƒíƒœ(ìµœì‹  ìƒíƒœ)ë¡œ ì—¬ê²¨ì§€ëŠ” ì‹œê°„ ( ì´ ì‹œê°„ ë™ì•ˆì€ ì¬ìš”ì²­ ì•ˆí•¨)
- **cacheTime** : ë°ì´í„°ê°€ ìºì‹œì— ìœ ì§€ë˜ëŠ” ì‹œê°„ ( ì´í›„ì— ì‚­ì œë¨)
- **retry** : ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ íšŸìˆ˜ ( ê¸°ë³¸ê°’ 3)
- **refetchOnWindowFocus** : ë‹¤ë¥¸ íƒ­ì´ë‚˜ ì•±ì„ ê°”ë‹¤ì™”ì„ ë•Œ ì¬ìš”ì²­ ì—¬ë¶€
- **onSuccess** : ìš”ì²­ ì„±ê³µ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°± í•¨ìˆ˜
- **onError** : ìš”ì²­ ì‹¤íŒ¨ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°± í•¨ìˆ˜

---

### pageParams

- **useInfiniteQuery**ê°€ ë‹¤ìŒ í˜ì´ì§€ ë˜ëŠ” ì´ì „ í˜ì´ì§€ë¥¼ ìš”ì²­í•  ë•Œ í•¨ìˆ˜ **queryFn**ì— ì „ë‹¬í•˜ëŠ” í˜„ì¬ í˜ì´ì§€ ì •ë³´ë¡œ ë³´í†µ í˜ì´ì§€ ë²ˆí˜¸ë‚˜ ì»¤ì„œ ê°™ì€ ê°’ì„

**ì „ë‹¬í•˜ëŠ” ì´ìœ ?**

- ì„œë²„ì—ì„œ í˜ì´ì§€ ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ ë°›ìœ¼ë ¤ë©´, ëª‡ ë²ˆì§¸ í˜ì´ì§€ë¥¼ ìš”ì²­í• ì§€ì— ëŒ€í•´ì„œ ì•Œë ¤ì¤˜ì•¼ í•˜ê¸° ë•Œë¬¸ì„
  ì˜ˆë¥¼ ë“¤ì–´ **/posts?page=2**ì™€ ê°™ì´ URLì— í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ë„£ì–´ ìš”ì²­í•´ì•¼ ë‹¤ìŒ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŒ
- ì£¼ë¡œ **getNextPageParams**, **getPreviousPageParams**ê°€ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì°¾ì•„ **queryFn**ì— **pageParams**ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë„˜ê²¨ì¤Œ

```jsx
useInfiniteQuery({
  queryKey: ["posts"],
  queryFn: ({ pageParam = 1 }) =>
    axios.get(`/posts?page=${pageParam}`).then((res) => res.data),
  getNextPageParam: (lastPage, allPages) => lastPage.nextPage,
  initialPageParam: 1,
});
```
